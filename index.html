<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boyer-Moore Visualizer (Mobile Ready)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>
        :root { 
            /* Slightly smaller cells for mobile screens */
            --cell-size: 44px; 
            --cell-gap: 4px; 
        }
        @media (min-width: 768px) {
            :root { --cell-size: 52px; }
        }

        .char-cell { 
            min-width: var(--cell-size); 
            height: var(--cell-size); 
            display: flex; align-items: center; justify-content: center; 
            border-radius: 8px; font-family: 'JetBrains Mono', monospace; font-weight: 800;
            position: relative; transition: background-color 0.2s, border-color 0.2s, transform 0.2s;
            font-size: 0.9rem;
        }
        @media (min-width: 768px) {
            .char-cell { font-size: 1.1rem; }
        }

        .text-box { background: #1e293b; border: 2px solid #334155; color: #f8fafc; }
        .pattern-box { background: #3b82f6; border: 2px solid #2563eb; color: white; }
        
        .comparing { border-color: #facc15 !important; transform: translateY(-4px); z-index: 20; box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
        .match { background-color: #22c55e !important; border-color: #16a34a !important; color: white; }
        .mismatch { background-color: #ef4444 !important; border-color: #b91c1c !important; color: white; }
        .found-permanent { background-color: #10b981; border-color: #059669; color: white; box-shadow: 0 0 15px rgba(16,185,129,0.4); }
        
        /* Custom scrollbar for the visualization area */
        .viz-scroll-container::-webkit-scrollbar { height: 6px; }
        .viz-scroll-container::-webkit-scrollbar-track { background: #0f172a; }
        .viz-scroll-container::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }

        input[type="range"] { accent-color: #6366f1; }
    </style>
</head>
<body class="bg-slate-950 text-slate-200 min-h-screen font-sans pb-10">

    <div class="max-w-6xl mx-auto p-4 md:p-6">
        <div class="flex flex-col items-center mb-6">
            <h1 class="text-2xl md:text-3xl font-black mb-4 bg-gradient-to-r from-blue-400 to-emerald-400 bg-clip-text text-transparent uppercase tracking-tight text-center">
                Boyer-Moore Search
            </h1>
            
            <div class="w-full grid grid-cols-1 sm:grid-cols-2 lg:flex lg:flex-row gap-3 items-end justify-center bg-slate-900 p-4 rounded-2xl border border-slate-800 shadow-xl">
                <div class="flex flex-col gap-1">
                    <label class="text-[10px] text-slate-500 font-bold uppercase ml-1">Text Source</label>
                    <input id="textInput" type="text" value="HELLOTESTOPENTEST" class="bg-slate-800 border-none p-2 rounded-lg w-full lg:w-48 text-center focus:ring-2 ring-blue-500 outline-none uppercase font-mono text-sm">
                </div>
                
                <div class="flex flex-col gap-1">
                    <label class="text-[10px] text-slate-500 font-bold uppercase ml-1">Pattern</label>
                    <input id="patternInput" type="text" value="TEST" class="bg-slate-800 border-none p-2 rounded-lg w-full lg:w-32 text-center focus:ring-2 ring-blue-500 outline-none uppercase font-mono text-sm">
                </div>

                <div class="flex gap-2 w-full lg:w-auto">
                    <button onclick="initialize()" class="flex-1 lg:flex-none bg-slate-700 hover:bg-slate-600 px-4 py-2 rounded-xl font-bold transition-all text-sm">Reset</button>
                    <button id="autoBtn" onclick="toggleAuto()" class="flex-[2] lg:flex-none bg-indigo-600 hover:bg-indigo-500 px-6 py-2 rounded-xl font-bold transition-all flex items-center justify-center gap-2 text-sm">
                        <span id="autoBtnText">Auto Play</span>
                    </button>
                </div>
                
                <div class="flex flex-col w-full sm:w-auto">
                    <span class="text-[10px] text-slate-500 font-bold uppercase tracking-widest mb-2 lg:mb-1">Speed Control</span>
                    <input id="speedSlider" type="range" min="200" max="1800" value="1000" class="w-full sm:w-32">
                </div>
            </div>
        </div>

        <div class="bg-slate-900 rounded-2xl md:rounded-3xl p-4 md:p-10 border border-slate-800 shadow-2xl relative">
            <div class="viz-scroll-container overflow-x-auto pb-4">
                <div id="viz-engine" class="relative" style="height: 120px; min-width: 100%;">
                    <div id="textRow" class="flex gap-[4px] absolute top-0 left-0"></div>
                    <div id="patternWrapper" class="absolute top-[55px] left-0">
                        <div id="patternRow" class="flex gap-[4px]"></div>
                    </div>
                </div>
            </div>

            <div class="flex flex-col sm:flex-row justify-between items-center mt-6 gap-4 border-t border-slate-800 pt-6">
                <div id="status" class="w-full sm:w-auto text-center sm:text-left text-blue-400 font-mono text-xs md:text-sm px-4 py-2 bg-blue-950/30 rounded-full border border-blue-900/50 italic">
                    Ready to begin...
                </div>
                <button id="stepBtn" onclick="nextStep()" class="w-full sm:w-auto bg-emerald-600 hover:bg-emerald-500 px-8 py-3 rounded-xl font-bold transition-all shadow-lg shadow-emerald-900/20 text-sm">
                    Next Step
                </button>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-8">
            <div class="bg-slate-900 p-5 rounded-2xl border border-slate-800 shadow-lg">
                <h3 class="text-slate-500 text-[10px] font-bold uppercase mb-4 tracking-widest">Bad Character Table</h3>
                <div id="tableContent" class="flex flex-wrap gap-2"></div>
            </div>
            <div class="bg-slate-900 p-5 rounded-2xl border border-slate-800 h-40 md:h-48 overflow-y-auto font-mono text-[10px] md:text-xs shadow-lg" id="logs">
                <div class="text-slate-600">// Process logs...</div>
            </div>
        </div>
    </div>

    <script>
        let text, pattern, table, i, reverseIdx;
        let isAutoRunning = false;
        let autoTimeout = null;

        // Function to get current cell width based on CSS variable
        function getCellWidth() {
            const style = getComputedStyle(document.documentElement);
            const size = parseInt(style.getPropertyValue('--cell-size'));
            const gap = parseInt(style.getPropertyValue('--cell-gap'));
            return size + gap;
        }

        function initialize() {
            stopAuto();
            text = document.getElementById('textInput').value.toUpperCase();
            pattern = document.getElementById('patternInput').value.toUpperCase();
            i = 0;
            reverseIdx = pattern.length - 1;
            
            table = {};
            for(let j = 0; j < pattern.length - 1; j++) {
                table[pattern[j]] = pattern.length - 1 - j;
            }
            table['*'] = pattern.length;

            render();
            updatePatternPos(false); // No animation on init
            document.getElementById('logs').innerHTML = '';
            addLog("Algorithm initialized.", "blue");
        }

        function render() {
            const cellWidth = getCellWidth();
            const tRow = document.getElementById('textRow');
            tRow.innerHTML = text.split('').map((c, idx) => `<div id="t-${idx}" class="char-cell text-box">${c}</div>`).join('');

            const pRow = document.getElementById('patternRow');
            pRow.innerHTML = pattern.split('').map((c, idx) => `<div id="p-${idx}" class="char-cell pattern-box">${c}</div>`).join('');

            const tContent = document.getElementById('tableContent');
            tContent.innerHTML = Object.entries(table).map(([k, v]) => `
                <div class="bg-slate-950 border border-slate-800 px-2 py-1 rounded-lg text-xs">
                    <span class="text-blue-400 font-bold">${k === '*' ? 'OTHER' : k}</span>:<span class="text-slate-300 ml-1">${v}</span>
                </div>
            `).join('');
            
            document.getElementById('viz-engine').style.width = (text.length * cellWidth) + "px";
        }

        function updatePatternPos(animate = true) {
            const cellWidth = getCellWidth();
            clearTemporaryStyles();
            gsap.to("#patternWrapper", { 
                x: i * cellWidth, 
                duration: animate ? 0.4 : 0, 
                ease: "power2.out" 
            });
        }

        function clearTemporaryStyles() {
            document.querySelectorAll('.char-cell').forEach(el => {
                el.classList.remove('comparing', 'match', 'mismatch');
            });
        }

        async function nextStep() {
            if (i > text.length - pattern.length) {
                document.getElementById('status').innerText = "Search Complete!";
                stopAuto();
                return;
            }

            let tIdx = i + reverseIdx;
            let pIdx = reverseIdx;

            const tEl = document.getElementById(`t-${tIdx}`);
            const pEl = document.getElementById(`p-${pIdx}`);

            if (!tEl || !pEl) return;

            clearTemporaryStyles();
            tEl.classList.add('comparing');
            pEl.classList.add('comparing');

            // Visual delay
            await new Promise(r => setTimeout(r, 300));

            if (text[tIdx] === pattern[pIdx]) {
                tEl.classList.replace('comparing', 'match');
                pEl.classList.replace('comparing', 'match');
                
                if (reverseIdx === 0) {
                    addLog(`MATCH at index ${i}`, 'emerald');
                    for(let k=0; k<pattern.length; k++) {
                        document.getElementById(`t-${i+k}`).classList.add('found-permanent');
                    }
                    await new Promise(r => setTimeout(r, 500));
                    i += 1;
                    reverseIdx = pattern.length - 1;
                    updatePatternPos();
                } else {
                    reverseIdx--;
                    document.getElementById('status').innerText = `Match '${text[tIdx]}'. Moving left...`;
                }
            } else {
                tEl.classList.replace('comparing', 'mismatch');
                pEl.classList.replace('comparing', 'mismatch');
                
                let endCharInText = text[i + pattern.length - 1];
                let shift = table[endCharInText] || table['*'];
                
                document.getElementById('status').innerText = `Mismatch! Shift: ${shift}`;
                addLog(`Shifted ${shift} via '${endCharInText}'`, 'red');

                await new Promise(r => setTimeout(r, 600));
                i += shift;
                reverseIdx = pattern.length - 1;
                updatePatternPos();
            }
        }

        function toggleAuto() { isAutoRunning ? stopAuto() : startAuto(); }

        function startAuto() {
            if (i > text.length - pattern.length) return;
            isAutoRunning = true;
            document.getElementById('autoBtnText').innerText = "Pause";
            document.getElementById('autoBtn').classList.replace('bg-indigo-600', 'bg-amber-600');
            runLoop();
        }

        function stopAuto() {
            isAutoRunning = false;
            clearTimeout(autoTimeout);
            document.getElementById('autoBtnText').innerText = "Auto Play";
            const btn = document.getElementById('autoBtn');
            btn.classList.contains('bg-amber-600') && btn.classList.replace('bg-amber-600', 'bg-indigo-600');
        }

        async function runLoop() {
            if (!isAutoRunning) return;
            await nextStep();
            if (i <= text.length - pattern.length) {
                let speed = 2000 - document.getElementById('speedSlider').value;
                autoTimeout = setTimeout(runLoop, speed);
            } else { stopAuto(); }
        }

        function addLog(msg, color) {
            const logs = document.getElementById('logs');
            logs.innerHTML = `<div class="text-${color}-400 mb-1 font-bold">> ${msg}</div>` + logs.innerHTML;
        }

        // Recalculate on window resize for responsiveness
        window.addEventListener('resize', () => {
            render();
            updatePatternPos(false);
        });

        initialize();
    </script>
</body>
</html>