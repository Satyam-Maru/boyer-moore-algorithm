<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Robust Boyer-Moore Visualizer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>
        :root { --cell-size: 50px; --cell-gap: 4px; }
        .char-cell { 
            width: var(--cell-size); height: var(--cell-size); 
            display: flex; align-items: center; justify-content: center; 
            border-radius: 8px; font-family: 'JetBrains Mono', monospace; font-weight: 800;
            position: relative; transition: background-color 0.2s, border-color 0.2s, transform 0.2s;
        }
        .text-box { background: #1e293b; border: 2px solid #334155; color: #f8fafc; }
        .pattern-box { background: #3b82f6; border: 2px solid #2563eb; color: white; }
        
        /* State Classes */
        .comparing { border-color: #facc15 !important; transform: translateY(-4px); z-index: 20; box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
        .match { background-color: #22c55e !important; border-color: #16a34a !important; color: white; }
        .mismatch { background-color: #ef4444 !important; border-color: #b91c1c !important; color: white; }
        .found-permanent { background-color: #10b981; border-color: #059669; color: white; box-shadow: 0 0 15px rgba(16,185,129,0.4); }
    </style>
</head>
<body class="bg-slate-950 text-slate-200 min-h-screen font-sans">

    <div class="max-w-6xl mx-auto p-6">
        <div class="flex flex-col items-center mb-8">
            <h1 class="text-3xl font-black mb-2 bg-gradient-to-r from-blue-400 to-emerald-400 bg-clip-text text-transparent uppercase tracking-tight">Boyer-Moore Search Engine</h1>
            <div class="flex gap-4 items-center bg-slate-900 p-4 rounded-2xl border border-slate-800 shadow-xl">
                <input id="textInput" type="text" value="hellotestopentest" class="bg-slate-800 border-none p-2 rounded-lg w-48 text-center focus:ring-2 ring-blue-500 outline-none uppercase font-mono">
                <span class="text-slate-600 font-bold">PATTERN:</span>
                <input id="patternInput" type="text" value="test" class="bg-slate-800 border-none p-2 rounded-lg w-32 text-center focus:ring-2 ring-blue-500 outline-none uppercase font-mono">
                <button onclick="initialize()" class="bg-blue-600 hover:bg-blue-500 px-6 py-2 rounded-xl font-bold transition-all active:scale-95">Reset</button>
            </div>
        </div>

        <div class="bg-slate-900 rounded-3xl p-10 border border-slate-800 shadow-2xl relative overflow-x-auto">
            <div id="viz-engine" class="relative mx-auto" style="height: 140px;">
                <div id="textRow" class="flex gap-[4px] absolute top-0 left-0"></div>
                <div id="patternWrapper" class="absolute top-[60px] left-0">
                    <div id="patternRow" class="flex gap-[4px]"></div>
                </div>
            </div>

            <div class="flex flex-wrap justify-between items-center mt-10 gap-4 border-t border-slate-800 pt-6">
                <div id="status" class="text-blue-400 font-mono text-sm px-4 py-2 bg-blue-950/30 rounded-full border border-blue-900/50 italic">Ready to begin...</div>
                <div class="flex gap-3">
                    <button id="stepBtn" onclick="nextStep()" class="bg-emerald-600 hover:bg-emerald-500 px-8 py-3 rounded-xl font-bold flex items-center gap-2 transition-all shadow-lg shadow-emerald-900/20">
                        Next Step
                    </button>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-8">
            <div class="bg-slate-900 p-6 rounded-2xl border border-slate-800 shadow-lg">
                <h3 class="text-slate-500 text-xs font-bold uppercase mb-4 tracking-widest">Shift Jump Table</h3>
                <div id="tableContent" class="flex flex-wrap gap-2"></div>
            </div>
            <div class="bg-slate-900 p-6 rounded-2xl border border-slate-800 h-48 overflow-y-auto font-mono text-xs shadow-lg" id="logs">
                <div class="text-slate-600">// Process logs will appear here...</div>
            </div>
        </div>
    </div>

    <script>
        let text, pattern, table, i, reverseIdx;
        const CELL_WIDTH = 50 + 4; // Width + Gap

        function initialize() {
            text = document.getElementById('textInput').value.toUpperCase();
            pattern = document.getElementById('patternInput').value.toUpperCase();
            i = 0;
            reverseIdx = pattern.length - 1;
            
            // Build Bad Match Table
            table = {};
            for(let j = 0; j < pattern.length; j++) {
                table[pattern[j]] = Math.max(1, pattern.length - j - 1);
            }
            table['*'] = pattern.length;

            render();
            updatePatternPos();
            addLog("Algorithm initialized. Starting from the right of the pattern.", "blue");
        }

        function render() {
            const tRow = document.getElementById('textRow');
            tRow.innerHTML = text.split('').map((c, idx) => `<div id="t-${idx}" class="char-cell text-box">${c}</div>`).join('');

            const pRow = document.getElementById('patternRow');
            pRow.innerHTML = pattern.split('').map((c, idx) => `<div id="p-${idx}" class="char-cell pattern-box">${c}</div>`).join('');

            const tContent = document.getElementById('tableContent');
            tContent.innerHTML = Object.entries(table).map(([k, v]) => `
                <div class="bg-slate-950 border border-slate-800 px-3 py-1 rounded-lg">
                    <span class="text-blue-400 font-bold">${k === '*' ? 'ANY' : k}</span> : <span class="text-slate-300">${v}</span>
                </div>
            `).join('');
            
            document.getElementById('viz-engine').style.width = (text.length * CELL_WIDTH) + "px";
        }

        function updatePatternPos() {
            // This clears any temporary styling on cells before moving
            clearTemporaryStyles();
            
            gsap.to("#patternWrapper", { 
                x: i * CELL_WIDTH, 
                duration: 0.5, 
                ease: "power2.inOut" 
            });
        }

        function clearTemporaryStyles() {
            // Robust fix: Remove mismatch/comparing classes from ALL text cells 
            // except those that are part of a confirmed permanent match.
            document.querySelectorAll('.text-box').forEach(el => {
                el.classList.remove('comparing', 'match', 'mismatch');
            });
            document.querySelectorAll('.pattern-box').forEach(el => {
                el.classList.remove('comparing', 'match', 'mismatch');
            });
        }

        async function nextStep() {
            if (i > text.length - pattern.length) {
                document.getElementById('status').innerText = "Search Complete!";
                return;
            }

            // 1. Highlight what we are comparing
            clearTemporaryStyles();
            let tIdx = i + reverseIdx;
            let pIdx = reverseIdx;

            const tEl = document.getElementById(`t-${tIdx}`);
            const pEl = document.getElementById(`p-${pIdx}`);

            tEl.classList.add('comparing');
            pEl.classList.add('comparing');

            await new Promise(r => setTimeout(r, 400));

            // 2. Check Match
            if (text[tIdx] === pattern[pIdx]) {
                tEl.classList.replace('comparing', 'match');
                pEl.classList.replace('comparing', 'match');
                
                if (reverseIdx === 0) {
                    addLog(`Success! Pattern found at index ${i}`, 'emerald');
                    for(let k=0; k<pattern.length; k++) {
                        document.getElementById(`t-${i+k}`).classList.add('found-permanent');
                    }
                    i += 1;
                    reverseIdx = pattern.length - 1;
                    setTimeout(updatePatternPos, 400);
                } else {
                    reverseIdx--;
                    document.getElementById('status').innerText = `Char matched! Checking index ${reverseIdx}...`;
                }
            } else {
                // 3. Handle Mismatch
                tEl.classList.replace('comparing', 'mismatch');
                pEl.classList.replace('comparing', 'mismatch');
                
                let lastCharInWindow = text[i + pattern.length - 1];
                let shift = table[lastCharInWindow] || table['*'];
                
                document.getElementById('status').innerText = `Mismatch! End-char '${lastCharInWindow}' says jump ${shift}`;
                addLog(`Shifted ${shift} units`, 'red');

                // Delay the jump so the user sees the red highlight
                setTimeout(() => {
                    i += shift;
                    reverseIdx = pattern.length - 1;
                    updatePatternPos();
                }, 600);
            }
        }

        function addLog(msg, color) {
            const logs = document.getElementById('logs');
            logs.innerHTML = `<div class="text-${color}-400 mb-1 font-bold">> ${msg}</div>` + logs.innerHTML;
        }

        initialize();
    </script>
</body>
</html> -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Robust Boyer-Moore Visualizer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>
        :root { --cell-size: 50px; --cell-gap: 4px; }
        .char-cell { 
            width: var(--cell-size); height: var(--cell-size); 
            display: flex; align-items: center; justify-content: center; 
            border-radius: 8px; font-family: 'JetBrains Mono', monospace; font-weight: 800;
            position: relative; transition: background-color 0.2s, border-color 0.2s, transform 0.2s;
        }
        .text-box { background: #1e293b; border: 2px solid #334155; color: #f8fafc; }
        .pattern-box { background: #3b82f6; border: 2px solid #2563eb; color: white; }
        
        .comparing { border-color: #facc15 !important; transform: translateY(-4px); z-index: 20; box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
        .match { background-color: #22c55e !important; border-color: #16a34a !important; color: white; }
        .mismatch { background-color: #ef4444 !important; border-color: #b91c1c !important; color: white; }
        .found-permanent { background-color: #10b981; border-color: #059669; color: white; box-shadow: 0 0 15px rgba(16,185,129,0.4); }
        
        input[type="range"] { accent-color: #6366f1; }
    </style>
</head>
<body class="bg-slate-950 text-slate-200 min-h-screen font-sans">

    <div class="max-w-6xl mx-auto p-6">
        <div class="flex flex-col items-center mb-8">
            <h1 class="text-3xl font-black mb-2 bg-gradient-to-r from-blue-400 to-emerald-400 bg-clip-text text-transparent uppercase tracking-tight">Boyer-Moore Search Engine</h1>
            <div class="flex flex-wrap gap-4 items-center justify-center bg-slate-900 p-4 rounded-2xl border border-slate-800 shadow-xl">
                <input id="textInput" type="text" value="HELLOTESTOPENTEST" class="bg-slate-800 border-none p-2 rounded-lg w-48 text-center focus:ring-2 ring-blue-500 outline-none uppercase font-mono">
                <span class="text-slate-600 font-bold">PATTERN:</span>
                <input id="patternInput" type="text" value="TEST" class="bg-slate-800 border-none p-2 rounded-lg w-32 text-center focus:ring-2 ring-blue-500 outline-none uppercase font-mono">
                <button onclick="initialize()" class="bg-slate-700 hover:bg-slate-600 px-4 py-2 rounded-xl font-bold transition-all active:scale-95">Reset</button>
                
                <div class="h-8 w-[2px] bg-slate-800 mx-2"></div>
                
                <button id="autoBtn" onclick="toggleAuto()" class="bg-indigo-600 hover:bg-indigo-500 px-6 py-2 rounded-xl font-bold transition-all active:scale-95 flex items-center gap-2">
                    <span id="autoBtnText">Auto Play</span>
                </button>
                
                <div class="flex flex-col">
                    <span class="text-[10px] text-slate-500 font-bold uppercase tracking-widest">Speed</span>
                    <input id="speedSlider" type="range" min="200" max="1800" value="1000" class="w-24">
                </div>
            </div>
        </div>

        <div class="bg-slate-900 rounded-3xl p-10 border border-slate-800 shadow-2xl relative overflow-x-auto">
            <div id="viz-engine" class="relative mx-auto" style="height: 140px;">
                <div id="textRow" class="flex gap-[4px] absolute top-0 left-0"></div>
                <div id="patternWrapper" class="absolute top-[60px] left-0">
                    <div id="patternRow" class="flex gap-[4px]"></div>
                </div>
            </div>

            <div class="flex flex-wrap justify-between items-center mt-10 gap-4 border-t border-slate-800 pt-6">
                <div id="status" class="text-blue-400 font-mono text-sm px-4 py-2 bg-blue-950/30 rounded-full border border-blue-900/50 italic">Ready to begin...</div>
                <div class="flex gap-3">
                    <button id="stepBtn" onclick="nextStep()" class="bg-emerald-600 hover:bg-emerald-500 px-8 py-3 rounded-xl font-bold flex items-center gap-2 transition-all shadow-lg shadow-emerald-900/20">
                        Manual Step
                    </button>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-8">
            <div class="bg-slate-900 p-6 rounded-2xl border border-slate-800 shadow-lg">
                <h3 class="text-slate-500 text-xs font-bold uppercase mb-4 tracking-widest">Bad Character Table (Shifts)</h3>
                <div id="tableContent" class="flex flex-wrap gap-2"></div>
            </div>
            <div class="bg-slate-900 p-6 rounded-2xl border border-slate-800 h-48 overflow-y-auto font-mono text-xs shadow-lg" id="logs">
                <div class="text-slate-600">// Process logs will appear here...</div>
            </div>
        </div>
    </div>

    <script>
        let text, pattern, table, i, reverseIdx;
        let isAutoRunning = false;
        let autoTimeout = null;
        const CELL_WIDTH = 50 + 4; 

        function initialize() {
            stopAuto();
            text = document.getElementById('textInput').value.toUpperCase();
            pattern = document.getElementById('patternInput').value.toUpperCase();
            i = 0;
            reverseIdx = pattern.length - 1;
            
            // Boyer-Moore-Horspool Bad Character Table
            table = {};
            for(let j = 0; j < pattern.length - 1; j++) {
                table[pattern[j]] = pattern.length - 1 - j;
            }
            table['*'] = pattern.length;

            render();
            updatePatternPos();
            document.getElementById('logs').innerHTML = '<div class="text-slate-600">// Process logs will appear here...</div>';
            addLog("Algorithm initialized. Matching right-to-left.", "blue");
        }

        function render() {
            const tRow = document.getElementById('textRow');
            tRow.innerHTML = text.split('').map((c, idx) => `<div id="t-${idx}" class="char-cell text-box">${c}</div>`).join('');

            const pRow = document.getElementById('patternRow');
            pRow.innerHTML = pattern.split('').map((c, idx) => `<div id="p-${idx}" class="char-cell pattern-box">${c}</div>`).join('');

            const tContent = document.getElementById('tableContent');
            tContent.innerHTML = Object.entries(table).map(([k, v]) => `
                <div class="bg-slate-950 border border-slate-800 px-3 py-1 rounded-lg">
                    <span class="text-blue-400 font-bold">${k === '*' ? 'OTHER' : k}</span> : <span class="text-slate-300">${v}</span>
                </div>
            `).join('');
            
            document.getElementById('viz-engine').style.width = (text.length * CELL_WIDTH) + "px";
        }

        function updatePatternPos() {
            clearTemporaryStyles();
            gsap.to("#patternWrapper", { 
                x: i * CELL_WIDTH, 
                duration: 0.4, 
                ease: "back.out(1.2)" 
            });
        }

        function clearTemporaryStyles() {
            document.querySelectorAll('.char-cell').forEach(el => {
                el.classList.remove('comparing', 'match', 'mismatch');
            });
        }

        async function nextStep() {
            if (i > text.length - pattern.length) {
                document.getElementById('status').innerText = "Search Complete!";
                stopAuto();
                return;
            }

            let tIdx = i + reverseIdx;
            let pIdx = reverseIdx;

            const tEl = document.getElementById(`t-${tIdx}`);
            const pEl = document.getElementById(`p-${pIdx}`);

            if (!tEl || !pEl) return;

            clearTemporaryStyles();
            tEl.classList.add('comparing');
            pEl.classList.add('comparing');

            // Wait for visual comparison
            await new Promise(r => setTimeout(r, 300));

            if (text[tIdx] === pattern[pIdx]) {
                tEl.classList.replace('comparing', 'match');
                pEl.classList.replace('comparing', 'match');
                
                if (reverseIdx === 0) {
                    addLog(`FULL MATCH at index ${i}`, 'emerald');
                    for(let k=0; k<pattern.length; k++) {
                        document.getElementById(`t-${i+k}`).classList.add('found-permanent');
                    }
                    
                    // After match, shift by 1 to continue searching
                    await new Promise(r => setTimeout(r, 500));
                    i += 1;
                    reverseIdx = pattern.length - 1;
                    updatePatternPos();
                } else {
                    reverseIdx--;
                    document.getElementById('status').innerText = `Matched '${text[tIdx]}'. Checking next left...`;
                }
            } else {
                tEl.classList.replace('comparing', 'mismatch');
                pEl.classList.replace('comparing', 'mismatch');
                
                // Boyer-Moore-Horspool uses the character in the text aligned with the pattern's end
                let endCharInText = text[i + pattern.length - 1];
                let shift = table[endCharInText] || table['*'];
                
                document.getElementById('status').innerText = `Mismatch! '${endCharInText}' at end suggests jump of ${shift}`;
                addLog(`Mismatch at ${tIdx}. Shifted ${shift}`, 'red');

                await new Promise(r => setTimeout(r, 600));
                i += shift;
                reverseIdx = pattern.length - 1;
                updatePatternPos();
            }
        }

        // Auto Run Logic
        function toggleAuto() {
            if (isAutoRunning) {
                stopAuto();
            } else {
                startAuto();
            }
        }

        function startAuto() {
            if (i > text.length - pattern.length) return;
            isAutoRunning = true;
            document.getElementById('autoBtnText').innerText = "Pause";
            document.getElementById('autoBtn').classList.replace('bg-indigo-600', 'bg-amber-600');
            runLoop();
        }

        function stopAuto() {
            isAutoRunning = false;
            clearTimeout(autoTimeout);
            document.getElementById('autoBtnText').innerText = "Auto Play";
            const btn = document.getElementById('autoBtn');
            if (btn.classList.contains('bg-amber-600')) {
                btn.classList.replace('bg-amber-600', 'bg-indigo-600');
            }
        }

        async function runLoop() {
            if (!isAutoRunning) return;
            
            await nextStep();
            
            if (i <= text.length - pattern.length) {
                let speed = 2000 - document.getElementById('speedSlider').value;
                autoTimeout = setTimeout(runLoop, speed);
            } else {
                stopAuto();
            }
        }

        function addLog(msg, color) {
            const logs = document.getElementById('logs');
            const time = new Date().toLocaleTimeString([], { hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' });
            logs.innerHTML = `<div class="text-${color}-400 mb-1 font-bold"><span class="text-slate-700 mr-2">[${time}]</span>> ${msg}</div>` + logs.innerHTML;
        }

        initialize();
    </script>
</body>
</html>